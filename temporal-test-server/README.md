# Temporal Test Workflow Server

This module includes an in-memory Temporal testing service implementation. It is
not intended to be used directly but rather by programming against the
`TestWorkflowEnvironment` interface in the `temporal-testing` module.

In addition to being consumed as a library by JVM-based languages, this module
can be built into a standalone executable and run as an independent process.

## Usage

Do not depend on this module directly, see the instructions in
[temporal-testing](../temporal-testing/README.md).

## In-memory Temporal testing service 

This service allows to run a test-only in-memory implementation of Temporal server API.

## To build a test server using GraalVM native-image

From the root of the java-sdk repo:
```
./gradlew :temporal-test-server:build
```
This will give you a native executable `build/graal/temporal-test-server`. The
executable requires a single argument: the port number on which it should
listen.

## To build a test server docker image

From the root of the java-sdk repo:
```
./gradlew :temporal-test-server:docker
```

This will result in a local image being built:
`temporalio/temporal-test-server`.

## GraalVM native-image configuration

The GraalVM native-image compiler uses the `native-image.properties` file and the
referenced JSON files during compilation. The JSON files are generated by
running the test server java code in a JVM configured with the [GraalVM tracing
agent](https://www.graalvm.org/latest/reference-manual/native-image/metadata/AutomaticMetadataCollection/):

:warning: Only code that is *executed* will be picked up by the agent.

Steps:

1. [Install GraalVM](https://www.graalvm.org/downloads/)
2. Run the SDK tests with the GraalVM tracing agent:
   ```
   ./gradlew temporal-testing:test -Pagent=standard
   ```
   Make sure that `JAVA_HOME` is pointing at the GraalVM installation.
